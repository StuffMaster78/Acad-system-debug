{
  "$id": "event_config_schema",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Notification Events (root)",
  "description": "Accepts either a map of events or a list of event items.",
  "oneOf": [
    {
      "type": "object",
      "required": ["events"],
      "properties": {
        "events": {
          "type": "object",
          "additionalProperties": { "$ref": "#/$defs/eventItem" }
        }
      },
      "additionalProperties": true
    },
    {
      "type": "array",
      "items": { "$ref": "#/$defs/eventItem" }
    }
  ],
  "$defs": {
    "eventItem": {
      "type": "object",
      "required": [
        "key", "label", "description", "enabled",
        "roles", "channels", "priority", "templates"
      ],
      "additionalProperties": true,
      "properties": {
        "key": {
          "type": "string",
          "pattern": "^[a-z0-9]+(\\.[a-z0-9_]+)+$",
          "minLength": 3,
          "description": "Canonical key, e.g. order.assigned"
        },
        "event_key": {
          "type": "string",
          "pattern": "^[a-z0-9]+(\\.[a-z0-9_]+)+$",
          "minLength": 3
        },
        "label": { "type": "string", "minLength": 1 },
        "description": { "type": "string", "minLength": 1 },
        "enabled": { "type": "boolean" },
        "roles": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "client", "writer", "admin", "support",
              "super_admin", "editor", "user"
            ]
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "channels": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "email", "in_app", "slack", "discord", "sms",
              "telegram", "whatsapp", "push", "webhook", "sse", "ws"
            ]
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "forced_channels": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "email", "in_app", "slack", "discord", "sms",
              "telegram", "whatsapp", "push", "webhook", "sse", "ws"
            ]
          },
          "default": [],
          "uniqueItems": true
        },
        "priority": {
          "oneOf": [
            { "type": "string", "enum": ["low", "normal", "medium", "high", "critical"] },
            { "type": "integer", "minimum": 0, "maximum": 10 }
          ]
        },
        "templates": {
          "type": "object",
          "description": "channel -> template name",
          "patternProperties": {
            "^(in_app|email|sms|push|webhook|telegram|whatsapp|sse|slack|discord|class_based)$": {
              "type": "string",
              "minLength": 1
            }
          },
          "additionalProperties": true
        },
        "meta": {
          "type": "object",
          "additionalProperties": true
        },
        "cooldown_seconds": {
          "type": "integer",
          "minimum": 0
        },
        "idempotency_key": { "type": "string" },
        "expires_after_seconds": {
          "type": "integer",
          "minimum": 1
        },
        "scope": {
          "type": "string",
          "enum": ["tenant", "global", "systemwide"],
          "default": "tenant"
        }
      }
    }
  }
}
