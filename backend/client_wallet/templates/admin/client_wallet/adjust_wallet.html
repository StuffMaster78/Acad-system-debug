{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:client_wallet_clientwallet_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {% trans 'Adjust Wallet' %}
</div>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>

<div class="module aligned">
    <h2>Wallet Information</h2>
    <div class="form-row">
        <div>
            <label><strong>Client:</strong></label>
            <p>{{ wallet.user.get_full_name|default:wallet.user.username }} ({{ wallet.user.email }})</p>
        </div>
        <div>
            <label><strong>Website:</strong></label>
            <p>{{ wallet.website.name }} ({{ wallet.website.domain }})</p>
        </div>
        <div>
            <label><strong>Current Balance:</strong></label>
            <p style="font-size: 1.2em; font-weight: bold; color: {% if wallet.balance >= 1000 %}green{% elif wallet.balance >= 100 %}blue{% elif wallet.balance > 0 %}orange{% else %}red{% endif %};">
                ${{ wallet.balance|floatformat:2 }}
            </p>
        </div>
        <div>
            <label><strong>Currency:</strong></label>
            <p>{{ wallet.currency }}</p>
        </div>
        <div>
            <label><strong>Loyalty Points:</strong></label>
            <p>{{ wallet.loyalty_points }}</p>
        </div>
    </div>
</div>

<form method="post" id="wallet-adjust-form">
    {% csrf_token %}
    
    <fieldset class="module aligned">
        <h2>Wallet Adjustment</h2>
        
        <div class="form-row">
            <div>
                <label for="{{ form.amount.id_for_label }}">{{ form.amount.label }}:</label>
                {{ form.amount }}
                {% if form.amount.help_text %}
                    <p class="help">{{ form.amount.help_text }}</p>
                {% endif %}
                {% if form.amount.errors %}
                    <ul class="errorlist">
                        {% for error in form.amount.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <p class="help">
                    <strong>Note:</strong> Enter a positive amount to credit (add money) or a negative amount to debit (remove money).
                    <br>Example: <code>50.00</code> to add $50, or <code>-25.00</code> to remove $25.
                </p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="{{ form.transaction_type.id_for_label }}">{{ form.transaction_type.label }}:</label>
                {{ form.transaction_type }}
                {% if form.transaction_type.help_text %}
                    <p class="help">{{ form.transaction_type.help_text }}</p>
                {% endif %}
                {% if form.transaction_type.errors %}
                    <ul class="errorlist">
                        {% for error in form.transaction_type.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="{{ form.reason.id_for_label }}">{{ form.reason.label }}:</label>
                {{ form.reason }}
                {% if form.reason.help_text %}
                    <p class="help">{{ form.reason.help_text }}</p>
                {% endif %}
                {% if form.reason.errors %}
                    <ul class="errorlist">
                        {% for error in form.reason.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
    </fieldset>
    
    <div class="submit-row">
        <input type="submit" value="Apply Adjustment" class="default" name="_save">
        <a href="{% url 'admin:client_wallet_clientwallet_changelist' %}" class="button">Cancel</a>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const amountField = document.getElementById('{{ form.amount.id_for_label }}');
    const typeField = document.getElementById('{{ form.transaction_type.id_for_label }}');
    
    // Update transaction type based on amount sign
    amountField.addEventListener('input', function() {
        const value = parseFloat(this.value);
        if (value > 0 && typeField.value === 'adjustment') {
            typeField.value = 'top-up';
        } else if (value < 0 && typeField.value === 'adjustment') {
            typeField.value = 'adjustment';
        }
    });
});
</script>
{% endblock %}

